<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/plan_list.css">

    <title>리스트</title>


</head>
<body>

<script>
    // 버튼 클릭 이벤트 핸들러

    function buttonHeart(planId) {
        var buttonId = 'heartButton_' + planId;
        var button = document.getElementById(buttonId);

        // AJAX 요청을 보냅니다.
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/plan/vote/' + planId, true);
        xhr.setRequestHeader('Content-Type', 'application/json');

        xhr.onload = function() {
            if (xhr.status === 200) {
                var img = document.getElementById('heartImage_' + planId);
                var currentSrc = img.src;

                // 이미지 경로를 변경하거나 토글합니다.
                if (currentSrc.includes('PlanUnlike.png')) {
                    img.src = '/img/PlanLike.png'; // 이미지를 좋아요 이미지로 변경
                } else {
                    img.src = '/img/PlanUnlike.png'; // 이미지를 다시 좋아요하지 않음 이미지로 변경
                }
            } else {
                console.error('서버 오류');
            }
        };

        xhr.send();
    }


</script>


<div class="background"></div>
<div class="background2"></div>



<div class="container">

    <div class="nav">
        <ul class="" style="list-style-type:none;">
            <li class="">
                <a class="logo" th:href="@{/}"><img src="/img/logo.png" style="float: left; width: 63px; height: 58px; margin-left: 10px; background-repeat: no-repeat;"></a>
                <div class="nav-left"
                     style="float:left;   margin-left: 440px; margin-top: 19px;  font-size: 20px;  font-family: 'Roboto', sans-serif; font-weight: 500;">
                    <a class="" th:href="@{/flightResult}"
                       style="margin-right: 50px; color:#4F54B4;">AIRPORT</a>
                    <a class="" th:href="@{/plan/add}"
                       style="margin-right: 50px; color:#4F54B4;">START PLAN</a>
                    <a class="" th:href="@{/touristAttraction/list}"
                       style="margin-right: 50px; color:#4F54B4;">ATTRACTIONS</a>
                    <a class="" th:href="@{/plan/list}"
                       style="color:#4F54B4;">PLAN LIST</a>
                </div>

                <div class="nav-right"
                     style="float:right;    margin-right: 35px; margin-top: 27px;  font-size: 12px;  font-family: 'Roboto', sans-serif; font-weight: 600;">
                    <a class="" th:href="@{/notice/list}"
                       style="margin-right: 20px; color:#4F54B4;">공지사항</a>
                    <a class="" th:href="@{/question/list}"
                       style="margin-right: 20px; color:#4F54B4;">고객센터</a>
                    <a class="loginBtn" sec:authorize="isAnonymous()" th:href="@{/login}"
                       style="margin-right: 20px; color:#4F54B4;">로그인</a>
                    <a class="" sec:authorize="isAuthenticated()" th:href="@{/myPage}"
                       style="margin-right: 20px; color:#4F54B4;">마이페이지</a>
                    <a class="" sec:authorize="isAuthenticated()" th:href="@{/logout}"
                       style="margin-right: 20px; color:#4F54B4;">로그아웃</a>
                    <a class="" sec:authorize="hasRole('ADMIN')" th:href="@{/user/list}"
                       style="color:#4F54B4;">ADMIN</a>
                </div>
            </li>
        </ul>

    </div>


    <div class="card-container">
        <div class="card-list" th:each="item : ${planList}">

            <a th:href="@{|/plan/detail?planId=${item.planId}|}">
                <div>

                    <div class="image-container">
                        <div class="left-side">
                            <div>
                                <img class="left-image" th:src="@{|${item.imagePath}|}"/>
                            </div>
                            <div th:text="|여행 테마 : ${item.type}|"></div>
                            <div th:text="${item.content}"></div>

                            <span th:if="${#authorization.expression('isAuthenticated()')}">
                                <a href="javascript:void(0);" th:id="'linkButton_' + ${item.planId}" th:onclick="'buttonHeart(' + ${item.planId} + ')'">
                                    <button class="heart-button">
                                        <img class="heart-img" th:src="${item.voter.contains(#authentication.principal.username) ? '/img/PlanLike.png' : '/img/PlanUnlike.png'}" th:id="'heartImage_' + ${item.planId}">
                                    </button>
                                </a>
                            </span>

                            <span th:unless="${#authorization.expression('isAuthenticated()')}">
                                <a th:href="@{|/login|}">
                                </a>
                                <a href="javascript:void(0);" onclick="heartLogin">
                                    <button class="heart-button">
                                         <img class="heart-img" src="/img/PlanUnlike.png">
                                    </button>
                                </a>
                            </span>
                        </div>

                        <div class="right-side">
                            <div>
                                <img class="right-image"  th:src="@{|/preview/${item.planId}.png|}" onerror="this.src='/preview/map_basic.png'"/>
                            </div>

                            <div th:text="|여정시작 : ${item.startDate}|"></div>
                            <div th:text="|여정종료 : ${item.endDate}|"></div>
                            <div th:text="|항공 : ${item.flightPrice}|"></div>
                            <div th:text="|경비 : ${item.withoutFlightPrice}|"></div>
                        </div>
                    </div>

                    </div>
                </a>

    </div>

</div>







</body>
</html>
